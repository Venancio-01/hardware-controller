# æºç æ ‘åˆ†æ

> **ç”Ÿæˆæ—¥æœŸ**: 2025-12-26
> **æ‰«ææ¨¡å¼**: å®Œå…¨æ‰«æ

---

## é¡¹ç›®ç›®å½•ç»“æ„

```
node-switch/                           # é¡¹ç›®æ ¹ç›®å½• (Monorepo)
â”‚
â”œâ”€â”€ packages/                          # å­åŒ…ç›®å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ frontend/                      # React å‰ç«¯åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.tsx               # ğŸš€ å‰ç«¯å…¥å£ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ routeTree.gen.ts       # è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±æ ‘
â”‚   â”‚   â”‚   â”œâ”€â”€ index.css              # å…¨å±€æ ·å¼ + Tailwind
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/                # TanStack Router è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __root.tsx         # æ ¹å¸ƒå±€ (QueryClient)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _auth.tsx          # è®¤è¯ä¿æŠ¤å¸ƒå±€
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ _auth.index.tsx    # é¦–é¡µ (éœ€è®¤è¯)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ login.tsx          # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ components/            # React ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/         # ä»ªè¡¨ç›˜ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ConfigForm.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AppConfigCard.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ NetworkConfigCard.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout/            # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ system/            # ç³»ç»Ÿç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config/            # é…ç½®ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ui/                # Shadcn UI (14ä¸ªç»„ä»¶)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useUpdateConfig.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ useImportExportConfig.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ useRestartSystem.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ contexts/              # React Context
â”‚   â”‚   â”‚   â”œâ”€â”€ api/                   # API å®¢æˆ·ç«¯é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/                   # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ services/              # æœåŠ¡å±‚
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ package.json               # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â”‚   â”œâ”€â”€ vite.config.ts             # Vite é…ç½®
â”‚   â”‚   â”œâ”€â”€ tailwind.config.js         # Tailwind é…ç½®
â”‚   â”‚   â””â”€â”€ tsconfig.json              # TypeScript é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ backend/                       # Express API åç«¯
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts               # ğŸš€ åç«¯å…¥å£ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts              # Express é…ç½®
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/                # API è·¯ç”±
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.routes.ts     # POST /api/auth/login
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config.routes.ts   # GET/PUT /api/config
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ status.routes.ts   # GET /api/status
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ system.routes.ts   # POST /api/system/restart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ conflict-detection.routes.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ services/              # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ config-import-export.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ restart.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ conflict-detection.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ connection-test.service.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ status.service.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/            # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ auth.middleware.ts # JWT è®¤è¯
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚       â””â”€â”€ logger.ts          # Pino æ—¥å¿—
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ package.json               # åç«¯ä¾èµ–é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ shared/                        # å…±äº«ç±»å‹å’ŒéªŒè¯
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.ts               # å¯¼å‡ºå…¥å£
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ schemas/               # Zod éªŒè¯ Schemas
â”‚       â”‚   â”‚   â”œâ”€â”€ config.schema.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ network.schema.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ device.schema.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ api-response.schema.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ auth.schema.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ test-connection.schema.ts
â”‚       â”‚   â”‚   â””â”€â”€ conflict-detection.schema.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â”œâ”€â”€ types/                 # TypeScript ç±»å‹
â”‚       â”‚   â”‚   â”œâ”€â”€ config.types.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ network.types.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ device.types.ts
â”‚       â”‚   â”‚   â””â”€â”€ api.types.ts
â”‚       â”‚   â”‚
â”‚       â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚       â”‚
â”‚       â””â”€â”€ package.json               # å…±äº«åº“é…ç½®
â”‚
â”œâ”€â”€ src/                               # ğŸ”§ æ ¸å¿ƒç¡¬ä»¶æ§åˆ¶æœåŠ¡
â”‚   â”œâ”€â”€ index.ts                       # ğŸš€ æ ¸å¿ƒæœåŠ¡å…¥å£ç‚¹
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                        # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.ts                   # ç¯å¢ƒå˜é‡ + Zod æ ¡éªŒ
â”‚   â”‚
â”‚   â”œâ”€â”€ state-machines/                # XState çŠ¶æ€æœº
â”‚   â”‚   â”œâ”€â”€ main-machine.ts            # ä¸»çŠ¶æ€æœº
â”‚   â”‚   â”œâ”€â”€ apply-ammo-machine.ts      # ä¾›å¼¹æµç¨‹çŠ¶æ€æœº
â”‚   â”‚   â”œâ”€â”€ monitor-machine.ts         # ç›‘æ§çŠ¶æ€æœº
â”‚   â”‚   â””â”€â”€ alarm-machine.ts           # æŠ¥è­¦çŠ¶æ€æœº
â”‚   â”‚
â”‚   â”œâ”€â”€ hardware/                      # ç¡¬ä»¶é€šä¿¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ manager.ts                 # UDP/TCP ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ initializer.ts             # ç¡¬ä»¶åˆå§‹åŒ–
â”‚   â”‚
â”‚   â”œâ”€â”€ relay/                         # ç»§ç”µå™¨æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ controller.ts              # å‘½ä»¤æ„å»ºå™¨
â”‚   â”‚   â”œâ”€â”€ reset.ts                   # ç»§ç”µå™¨é‡ç½®
â”‚   â”‚   â””â”€â”€ validation.ts              # ç»§ç”µå™¨éªŒè¯
â”‚   â”‚
â”‚   â”œâ”€â”€ voice-broadcast/               # è¯­éŸ³æ’­æŠ¥
â”‚   â”‚   â”œâ”€â”€ index.ts                   # æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ initializer.ts             # åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ types.ts                   # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ validation.ts              # éªŒè¯
â”‚   â”‚
â”‚   â”œâ”€â”€ udp/                           # UDP é€šä¿¡
â”‚   â”‚   â””â”€â”€ client.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ tcp/                           # TCP é€šä¿¡
â”‚   â”‚   â””â”€â”€ client.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ business-logic/                # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ relay-status-aggregator.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ logger/                        # Pino æ—¥å¿—
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ pino.ts
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚
â”‚   â””â”€â”€ types/                         # ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ index.ts
â”‚       â””â”€â”€ state-machine.ts
â”‚
â”œâ”€â”€ docs/                              # ğŸ“š é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture.md                # æ¶æ„æ–‡æ¡£ (ç”Ÿæˆ)
â”‚   â”œâ”€â”€ component-inventory-root.md    # ç»„ä»¶æ¸…å• (ç”Ÿæˆ)
â”‚   â”œâ”€â”€ source-tree-analysis.md        # æºç åˆ†æ (ç”Ÿæˆ)
â”‚   â”œâ”€â”€ ETH è®¾å¤‡é€šä¿¡åè®®è¯´æ˜V42.md     # åè®®è§„èŒƒ
â”‚   â”œâ”€â”€ CX-815E ç½‘å£è¯­éŸ³æ’­æŠ¥æ¨¡å—é›†æˆæŒ‡å—.md
â”‚   â”œâ”€â”€ çŠ¶æ€æœºè®¾è®¡æ–¹æ¡ˆ.md
â”‚   â”œâ”€â”€ çŠ¶æ€æœºæ¸…å•.md
â”‚   â””â”€â”€ ä¸šåŠ¡æµè½¬çŠ¶æ€.md
â”‚
â”œâ”€â”€ config/                            # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ node-switch.service            # Systemd æœåŠ¡æ–‡ä»¶
â”‚
â”œâ”€â”€ test/                              # æµ‹è¯•æ–‡ä»¶
â”‚
â”œâ”€â”€ scripts/                           # æ„å»ºè„šæœ¬
â”‚
â”œâ”€â”€ .env                               # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.example                       # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ package.json                       # æ ¹åŒ…é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml                # pnpm å·¥ä½œåŒºé…ç½®
â”œâ”€â”€ tsconfig.json                      # TypeScript é…ç½®
â””â”€â”€ vitest.config.ts                   # Vitest é…ç½®
```

---

## å…³é”®å…¥å£ç‚¹

| å…¥å£ç‚¹ | è·¯å¾„ | æè¿° |
|--------|------|------|
| ğŸš€ æ ¸å¿ƒæœåŠ¡ | `src/index.ts` | ç¡¬ä»¶é€šä¿¡æœåŠ¡å¯åŠ¨ |
| ğŸš€ å‰ç«¯åº”ç”¨ | `packages/frontend/src/main.tsx` | React åº”ç”¨å…¥å£ |
| ğŸš€ åç«¯ API | `packages/backend/src/index.ts` | Express æœåŠ¡å¯åŠ¨ |

---

## éƒ¨ä»¶é—´ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  frontend   â”‚â”€â”€â”€â”€â–¶â”‚   shared    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â–²
       â”‚                   â”‚
       â–¼                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   backend   â”‚â”€â”€â”€â”€â–¶â”‚   shared    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/core   â”‚ (ç‹¬ç«‹è¿è¡Œ)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
