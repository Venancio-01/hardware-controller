# Track Spec: 建立核心测试套件并完善硬件协议校验

## 1. 目标
为 Node Switch 项目建立稳固的测试基础，并确保硬件通信协议的解析与构建具备极高的鲁棒性，符合工业级可靠性要求。

## 2. 核心范围
- **测试框架配置**：利用 Bun 内置的测试运行器（bun test）配置基础环境。
- **UDP/TCP 模拟器**：实现可重用的 Mock 类，用于在不依赖物理硬件的情况下测试通信逻辑。
- **协议校验增强**：
    - 为 `ETH 设备通信协议` 完善 Zod Schema。
    - 为 `CX-815E 语音播报协议` 完善 Zod Schema。
- **单元测试覆盖**：
    - 继电器命令构建逻辑。
    - 语音播报指令封装。
    - 通信客户端的重试逻辑。

## 3. 技术设计
- **测试库**：Bun Test (内置)。
- **Mock 策略**：使用接口抽象底层 Socket 操作，通过注入 Mock 实现来验证边界情况（如超时、非法报文、连接中断）。
- **校验逻辑**：所有从网络接收的 Buffer 必须先通过 Zod schema 解析为结构化对象，之后才能进入业务处理层。

## 4. 验收标准
- [ ] 测试套件可通过 `bun test` 成功运行。
- [ ] 继电器和语音模块的所有核心指令集均有对应的单元测试。
- [ ] 模拟网络丢包或超时情况，验证自动重试机制是否按预期工作（基于产品准则）。
- [ ] 整体代码测试覆盖率达到 80% 以上。
